<?xml version="1.0"?>

<project xmlns:sfcontrib="antlib:com.aquivalabs.force.ant" default="deploy">
    <property file="build.properties" />
    <property name="sf.server" value="https://login.salesforce.com" />
    <property name="sf.testLevel" value="RunSpecifiedTests" />
    <property name="outputdir" value="artifacts" />

    <taskdef
        uri="antlib:com.aquivalabs.force.ant"
        name="deploy"
        classname="com.aquivalabs.force.ant.DeployWithTestReportsTask"
        classpath="${lib.dir}" />
    <taskdef
        uri="antlib:com.aquivalabs.force.ant"
        name="executeApex"
        classname="com.aquivalabs.force.ant.ExecuteAnonymousApexTask"
        classpath="${lib.dir}" />

    <target name="deploy">
        <sfcontrib:deploy
            username="${sf.username}"
            password="${sf.password}${sf.token}"
            serverUrl="${sf.server}"
            deployRoot="src"
            rollbackOnError="true"
            testLevel="${sf.testLevel}"
            reportDir="${outputdir}/test-reports">
            <batchtest>
                <fileset dir="src/classes" includes="*TestClass.cls" />
            </batchtest>
            <junitReport file="TEST-ApexTests.xml" suiteName="Apex" />
            <coberturaReport file="Apex-Coverage.xml" />
            <htmlCoverageReport file="coverage.html" />
        </sfcontrib:deploy>
    </target>

    <target name="executeApex">
        <sfcontrib:executeApex
            username="${sf.username}"
            password="${sf.password}${sf.token}"
            serverUrl="${sf.server}"
            expandProperties="true">
                System.debug('Hello from ${sf.username}!');
        </sfcontrib:executeApex>
    </target>
</project>